def solution(s, n):
    import re
    from functools import lru_cache
    
    def fibonacci(k):
        if k == 0:
            return 0
        elif k == 1:
            return 1
        else:
            return fibonacci(k - 1) + fibonacci(k - 2)
    
    vowels = r'[aeiouAEIOU]+'
    modified_string = re.sub(vowels, '_', s)
    count_underscores = modified_string.count('_')
    
    if count_underscores % 3 == 0:
        return fibonacci(n)
    else:
        matrix = [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
        return sum(set(matrix[n]))